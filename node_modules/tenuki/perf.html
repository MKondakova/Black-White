<!doctype html>
<head>
  <title>perf.html</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
  <link rel="stylesheet" href="build/tenuki.css">
  <script src="build/tenuki.js"></script>

  <link rel="stylesheet" href="examples/example.css">

  <style>
    .tenuki-board {
      float: left;
      width: 500px;
      height: 500px;
      margin: 1px;
    }

    a {
      display: block;
    }
  </style>
  <body><a href="#" id="random">Random</a> <a href="#" id="stop">Stop</a></body>
</head>

<script>
  var games = [];
  window.games = games;

  for (var i = 0; i < 1; i++) {
    var el = document.createElement("div");
    el.classList.add("tenuki-board");
    // el.classList.add("tenuki-board-flat");
    document.querySelector("body").appendChild(el);

    // g.setup({boardSize: 19, handicapStones: 2 + Math.floor(Math.random()*(7 + 1))});
    for (var x = 0; x < 1; x++) {
      el.innerHTML = "";
      const g = new tenuki.Game({
        element: el,
        boardSize: 19,
        fuzzyStonePlacement: false,
        renderer: "dom"
      });
      // g.setup({boardSize: 19, koRule: "superko"});
      // g.setup({boardSize: 19});
      games.push(g);
    }
  };

  function playRandom(e) {
    e.preventDefault();

    window.randomInterval = setInterval(function() {
      var games = window.games;
      var g = games[Math.floor(Math.random() * games.length)];
      var points = g.intersections().filter(i => i.isEmpty());

      var i = points[Math.floor(Math.random() * points.length)];
      var attempts = 0;

      while (g.isIllegalAt(i.y, i.x)) {
        i = points[Math.floor(Math.random() * points.length)];
        attempts += 1;

        if (attempts > 10) {
          g.pass();
        }

        if (attempts > 100) {
          console.log("Resetting game " + games.indexOf(g));

          g.renderer.boardElement.innerHTML = "";
          var newG = new tenuki.Game({ element: g.renderer.boardElement, boardSize: g.boardSize, koRule: g.ruleset.koRule, handicapStones: g.handicapStones });

          games[games.indexOf(g)] = newG;
        }
      }

      g.playAt(i.y, i.x);

      // g.territory();
    }, 0);

    return false;
  };

  function stop(e) {
    e.preventDefault();
    clearInterval(window.randomInterval);
    return false;
  }

  document.querySelector("#random").addEventListener("click", playRandom, false);
  document.querySelector("#stop").addEventListener("click", stop, false);
</script>
